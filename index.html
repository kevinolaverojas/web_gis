<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Catastro de Basurales</title>

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #eef1f5;
    }

    header {
        background: #12263A;
        color: white;
        text-align: center;
        padding: 20px;
        font-size: 22px;
    }

    #container {
        display: grid;
        grid-template-columns: 65% 35%;
        height: calc(100vh - 110px);
    }

    #map {
        width: 100%;
        height: 100%;
    }

    #formulario {
        background: white;
        padding: 20px;
        overflow-y: scroll;
        border-left: 3px solid #12263A;
    }

    label {
        font-weight: bold;
        margin-top: 10px;
        display: block;
    }

    input, select, textarea {
        width: 100%;
        margin-top: 5px;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #777;
    }

    button {
        background: #1E74FF;
        padding: 12px;
        width: 100%;
        border: none;
        color: white;
        margin-top: 15px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
    }

    #preview {
        width: 100%;
        margin-top: 10px;
        display: none;
        border-radius: 5px;
    }

    #mensaje {
        margin-top: 20px;
        font-weight: bold;
    }
</style>
</head>

<body>

<header>
    <h2>Catastro de Basurales</h2>
    <p>Haz clic en el mapa o usa tu GPS para seleccionar la ubicación.</p>
</header>

<div id="container">

    <!-- MAPA -->
    <div id="map"></div>

    <!-- FORMULARIO -->
    <div id="formulario">

        <h3>Nuevo reporte de basural</h3>

        <label>Coordenadas:</label>
        <input type="text" id="lat" readonly>
        <input type="text" id="lng" readonly>

        <label>Tipo de basural:</label>
        <select id="tipo">
            <option value="">Selecciona una opción</option>
            <option value="domestico">Doméstico</option>
            <option value="escombros">Escombros</option>
            <option value="mixto">Mixto</option>
            <option value="organico">Orgánico</option>
            <option value="industrial">Industrial</option>
        </select>

        <label>Volumen estimado (m³) (solo positivos):</label>
        <input type="number" id="volumen" min="0">

        <label>Nivel de peligro:</label>
        <select id="peligro">
            <option value="">Selecciona</option>
            <option value="bajo">Bajo</option>
            <option value="medio">Medio</option>
            <option value="alto">Alto</option>
        </select>

        <label>Descripción:</label>
        <textarea id="descripcion" placeholder="Detalles del basural..."></textarea>

        <label>Subir foto o tomarla con la cámara:</label>
        <input type="file" accept="image/*" capture="environment" id="foto">

        <img id="preview">

        <label>Fecha y hora:</label>
        <input type="datetime-local" id="fecha">

        <button id="guardar">Guardar reporte</button>

        <p id="mensaje"></p>

    </div>
</div>

<script>
    // --------------------
    // MAPA
    // --------------------
    var map = L.map('map').setView([-37.47, -72.35], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
    }).addTo(map);

    var markerIcon = L.icon({
        iconUrl: "https://cdn-icons-png.flaticon.com/512/684/684908.png",
        iconSize: [40, 40],
        iconAnchor: [20, 40]
    });

    let marker;

    // Clic en el mapa → agregar punto
    map.on("click", function(e) {
        let lat = e.latlng.lat.toFixed(6);
        let lng = e.latlng.lng.toFixed(6);

        document.getElementById("lat").value = lat;
        document.getElementById("lng").value = lng;

        if (marker) map.removeLayer(marker);

        marker = L.marker([lat, lng], { icon: markerIcon }).addTo(map);
    });

    // GPS automático
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(pos) {
            let lat = pos.coords.latitude;
            let lng = pos.coords.longitude;

            map.setView([lat, lng], 16);

            if (marker) map.removeLayer(marker);
            marker = L.marker([lat, lng], { icon: markerIcon }).addTo(map);

            document.getElementById("lat").value = lat.toFixed(6);
            document.getElementById("lng").value = lng.toFixed(6);
        });
    }

    // Foto → previsualización
    document.getElementById("foto").addEventListener("change", function(e) {
        let file = e.target.files[0];
        if (!file) return;

        let reader = new FileReader();
        reader.onload = function(r) {
            let img = document.getElementById("preview");
            img.src = r.target.result;
            img.style.display = "block";
        };
        reader.readAsDataURL(file);
    });

    // Guardar reporte
    document.getElementById("guardar").addEventListener("click", function() {
        let lat = lat.value;
        let lng = lng.value;

        if (!lat || !lng) {
            alert("Debes seleccionar una ubicación en el mapa.");
            return;
        }

        document.getElementById("mensaje").innerHTML =
            "✔ Reporte generado correctamente (solo visual).";

        console.log("Reporte generado — SOLO VISTA PREVIA");
    });
</script>

</body>
</html>
